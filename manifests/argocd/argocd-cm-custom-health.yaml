apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # 自定义 Ingress 健康检查
  # 问题：ArgoCD 默认检查 Ingress 的 loadBalancer.ingress 状态
  # 但我们使用 NodePort + HAProxy，不会有 LoadBalancer IP
  # 导致所有 Ingress 永远处于 Progressing 状态
  # 解决方案：自定义健康检查，只要 Ingress 存在就认为健康
  resource.customizations.health.networking.k8s.io_Ingress: |
    hs = {}
    hs.status = "Healthy"
    hs.message = "Ingress is configured (NodePort mode, no LoadBalancer required)"
    return hs












